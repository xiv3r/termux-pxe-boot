# Universal Network Bridge System

Enhanced network interface detection system specifically designed for mixed network scenarios.

## Overview

The Universal Network Bridge System is designed to detect and handle complex network configurations, particularly the **Primary Scenario**: PC on ethernet + Phone on WiFi connected to same router, and various **Secondary Scenarios**: USB tethering, WiFi Direct, and other configurations.

## Key Features

### üéØ Advanced Network Topology Detection
- **Multi-method Interface Detection**: Uses psutil, system commands, and fallback methods
- **Network Segment Mapping**: Identifies all network interfaces with their types and configurations
- **Router Isolation Detection**: Detects isolation between ethernet/wifi segments
- **Cross-Segment Connectivity Testing**: Tests multicast, broadcast, and direct connectivity

### üåê Cross-Network Interface Identification
- **Mixed Scenario Detection**: Automatically identifies PC on ethernet + Phone on WiFi scenarios
- **USB Tethering Recognition**: Detects when phone has both WiFi and USB tethering
- **WiFi Direct Detection**: Identifies bridge candidates for direct connections
- **Router Behavior Analysis**: Determines isolation vs. bridge mode operation

### üåâ Universal Network Bridge Creator
- **UDP Tunnel Bridges**: Software-defined bridges using UDP tunnels
- **WiFi Direct Bridges**: Direct wireless connections bypassing router isolation
- **USB Tethering Bridges**: USB-based network bridging
- **Ad-hoc Network Bridges**: Temporary wireless network creation
- **Linux Software Bridges**: Native bridge support for Linux systems

### ‚ö° Mixed Network PXE Configuration
- **Interface-Specific DHCP**: Different DHCP ranges for each network segment
- **Cross-Network TFTP Relay**: TFTP server capabilities across bridged networks
- **Broadcast Domain Extension**: Extends PXE boot capabilities across interfaces
- **Automatic Conflict Resolution**: Prevents IP conflicts in mixed networks

### üîÑ Advanced Features
- **Zero-Configuration Operation**: Automatic detection and bridge creation
- **Fallback Chains**: Multiple bridge creation methods with automatic fallback
- **Router-Agnostic Design**: Works with any router configuration
- **Cross-Platform Compatibility**: Android/Linux/Windows support
- **Integration with Existing Systems**: Seamless integration with PXE servers
- **Comprehensive Monitoring**: Real-time bridge health and connectivity monitoring

## Installation & Usage

### Quick Start

```bash
# Run the universal network bridge system
python3 UNIVERSAL_NETWORK_BRIDGE.py

# Run with auto-bridge enabled
python3 UNIVERSAL_NETWORK_BRIDGE.py --auto-bridge

# Show network topology
python3 UNIVERSAL_NETWORK_BRIDGE.py --topology

# Show PXE configuration
python3 UNIVERSAL_NETWORK_BRIDGE.py --pxe-config
```

### Test Suite

```bash
# Run complete test suite
python3 test_universal_network_bridge.py --test

# Run interactive demonstration
python3 test_universal_network_bridge.py --demo

# Generate test report
python3 test_universal_network_bridge.py --report

# Quick validation
python3 test_universal_network_bridge.py --quick
```

## Configuration

Create a configuration file (JSON format) to customize the system:

```json
{
  "bridge_base_port": 9000,
  "max_bridges": 4,
  "discovery_timeout": 5,
  "heartbeat_interval": 30,
  "auto_bridge": true,
  "zero_config": true,
  "debug_mode": false,
  "pxe_server_integration": true,
  "fallback_enabled": true,
  "performance_mode": false,
  "router_agnostic": true,
  "cross_platform": true
}
```

## Architecture

### Core Components

1. **NetworkInterface**: Enhanced interface representation with capabilities and metadata
2. **NetworkSegment**: Network segment with isolation detection and bridge requirements
3. **BridgeEndpoint**: UDP tunnel endpoints for cross-network communication
4. **UniversalNetworkBridge**: Main system orchestrator

### Bridge Creation Methods

1. **UDP Tunnel Bridge**: Software-defined bridge using UDP encapsulation
2. **WiFi Direct Bridge**: Direct wireless peer-to-peer connections
3. **USB Tethering Bridge**: USB network interface bridging
4. **Ad-hoc Bridge**: Temporary wireless network creation
5. **Software Bridge**: Native Linux bridge utilities

### Fallback Chain

The system automatically tries bridge creation methods in order:
1. UDP Tunnel (most compatible)
2. WiFi Direct (wireless scenarios)
3. USB Tethering (mobile scenarios)
4. Ad-hoc Bridge (emergency fallback)
5. Software Bridge (Linux native)

## Network Scenarios Handled

### Primary Scenario: PC on Ethernet + Phone on WiFi
```python
# Automatic detection and bridging
bridge = UniversalNetworkBridge()
bridge.start()
# Automatically creates bridge between ethernet and WiFi segments
```

### USB Tethering Scenario
```python
# Detects USB tethering interfaces
bridge._create_usb_tethering_bridge(segment)
# Creates bridge via USB network interface
```

### WiFi Direct Scenario
```python
# Creates peer-to-peer connection
bridge._create_wifi_direct_bridge(segment)
# Bypasses router isolation completely
```

### Mixed Network PXE Boot
```python
# Get PXE configuration for all interfaces
pxe_config = bridge.get_pxe_server_config()
# Returns interface-specific DHCP ranges and TFTP servers
```

## Integration Examples

### With Existing PXE Server

```python
from UNIVERSAL_NETWORK_BRIDGE import UniversalNetworkBridge
from pxe.server import PXEServer

# Initialize both systems
bridge = UniversalNetworkBridge()
bridge.start()

pxe_server = PXEServer(settings, logger, bridge.network_manager)
pxe_server.start()
```

### Custom Bridge Creation

```python
# Create bridge between specific interfaces
bridge.create_bridge("eth0", "wlan0")

# Get topology for external processing
topology = bridge.get_network_topology()
```

## Performance Features

- **Concurrent Interface Analysis**: Multi-threaded interface detection
- **Optimized Caching**: Interface information caching with TTL
- **Parallel Connectivity Testing**: Simultaneous network tests
- **Resource Management**: Automatic cleanup of stale connections

## Monitoring & Debugging

```python
# Get detailed topology information
topology = bridge.get_network_topology()
print(f"Interfaces: {len(topology['interfaces'])}")
print(f"Segments: {len(topology['segments'])}")
print(f"Active Tunnels: {topology['active_tunnels']}")

# Enable debug mode
bridge.debug_mode = True
```

## Troubleshooting

### Common Issues

1. **No Interfaces Detected**
   - Check network interface status
   - Verify permissions for network commands
   - Try compatibility mode

2. **Bridge Creation Fails**
   - Check fallback chain configuration
   - Verify network interface capabilities
   - Enable debug mode for details

3. **PXE Boot Issues**
   - Verify interface-specific DHCP configuration
   - Check TFTP server setup
   - Validate network segment mapping

### Debug Commands

```bash
# Check network interfaces
ip link show
ip addr show

# Test connectivity between segments
ping -I eth0 192.168.1.1
ping -I wlan0 192.168.1.1

# Check wireless capabilities
iw list
iw dev wlan0 info
```

## Platform Support

### Linux (Full Support)
- All bridge types supported
- Native network utilities integration
- Complete interface detection methods

### Android/Termux (Enhanced Support)
- WiFi Direct detection
- USB tethering recognition
- Termux-specific optimizations

### Windows (Basic Support)
- Interface detection via ipconfig
- Software bridge capabilities
- Limited wireless feature support

## Security Considerations

- UDP tunnel encryption support
- Secure bridge endpoint authentication
- Network isolation validation
- Broadcast domain security

## Future Enhancements

- IPv6 support
- Advanced encryption for tunnels
- Machine learning-based bridge optimization
- Cloud integration capabilities
- Enhanced WiFi Direct support

## License

This Universal Network Bridge System is designed for educational and research purposes. Use responsibly and in accordance with local network regulations.

## Contributing

The system is designed to be extensible. Key areas for contribution:
- Additional bridge creation methods
- Enhanced platform support
- Performance optimizations
- Security enhancements

## Support

For issues and questions:
1. Run the test suite to identify problems
2. Check debug mode output
3. Review network topology detection results
4. Verify fallback chain functionality

---

**Universal Network Bridge System** - Making complex network scenarios simple through intelligent automation.